<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PosDAO">



	<!-- 매장 pos기 메뉴조회 -->
	<select id="getStoreMenuList" resultType="menu">
		SELECT DISTINCT 
		M_NAME "mName"
		,M_NUM "mNum"
		, M_PRICE "mPrice"
		,CA_NUM "caNum"
		 FROM MENU
		 WHERE S_ID= #{sId} 
	</select>
	<!-- 메뉴선택시 옵션 가져오기 -->
	<select id="getOptionList" resultType="recipe">
		SELECT
		M_NUM "mNum"
		, OP_NAME "opName"
		, OP_PRICE "opPrice"
		, RECIPENO "recipeno"
		, CA_NUM "caNum"
		FROM RECIPE
		WHERE S_ID= #{sId}
		AND M_NUM = #{mNum}
		AND( CA_NUM = 'CAOP'
		OR CA_NUM = 'CAIC'
		OR CA_NUM = 'CAHT')
		ORDER BY OP_NAME
	</select>
	<!-- 고객 검색 -->
	<select id="getCusList" resultType="viewposcussearch">
	SELECT 
			C_ID "cId"
			, C_NICK "cNick"
			, C_TEL "cTel"
			, C_NAME "cName"
			, MILEAGE "mileage"
			, S_ID "sId"
	FROM POSCUSSEARCH_VIEW
	WHERE 
	S_ID= #{sId}
	AND (C_TEL like '%' || #{cTel} || '%'
	OR C_NAME like '%' || #{cTel} || '%')
	</select>
<!-- 환불위한 주문내역 조회 -->
	<select id="getCusRefund" resultType="order">
	SELECT
			O_NUM "oNum"
		   , C_ID "cId"
		   , O_DATE "oDate"
		   , TOTAL "total"
		   , PAY_METHOD payMethod
		   , MILEAGE mileage
	FROM ORDERS
	<where>
	S_ID=#{sId}
	<if test="startDate != null and startDate !='' and endDate !=null and startDate !=''">
				 O_DATE BETWEEN #{startDate} AND #{endDate}
			</if>
	AND DELIVERY_STATUS ='C5'
	</where>
	</select> 
</mapper>